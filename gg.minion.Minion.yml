app-id: gg.minion.Minion
runtime: org.freedesktop.Platform
runtime-version: '22.08'
command: minion.sh
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk17
tags:
  - proprietary
finish-args:
  - --env=PATH=/app/jre/bin:/app/bin
  - --socket=x11
  - --share=network
  - --persist=.minion
  - --filesystem=~/.steam
  - --filesystem=~/.local/share/Steam
  - --filesystem=~/.var/app/com.valvesoftware.Steam
  - --filesystem=~/Games
modules:
  - name: openjdk
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/openjdk17/install.sh
  - name: openjfx
    buildsystem: simple
    build-commands:
      - mkdir -p  /app/javafx
      - cp -r lib /app/javafx
    sources:
      - type: archive
        url: https://download2.gluonhq.com/openjfx/17.0.7/openjfx-17.0.7_linux-x64_bin-sdk.zip
        sha256: 4a2a13ef86b3a89a54f6420ef6bb0f4b111ad3adf1111c59760474a41e2a8bed
        only-arches:
          - x86_64
      - type: archive
        url: https://download2.gluonhq.com/openjfx/17.0.7/openjfx-17.0.7_linux-aarch64_bin-sdk.zip
        sha256: 8c8ee1bd13b8cde8f980b869cfc7efd1f73c5a8d32b29142761324f60d709e1e
        only-arches:
          - aarch64
  - name: minion
    buildsystem: simple
    build-commands:
      - install -Dm755 apply-extra                ${FLATPAK_DEST}/bin/apply_extra
      - install -Dm755 minion.sh                  ${FLATPAK_DEST}/bin/minion.sh
      - install -Dm644 ${FLATPAK_ID}.png          ${FLATPAK_DEST}/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png
      - install -Dm644 ${FLATPAK_ID}.desktop      ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 ${FLATPAK_ID}.metainfo.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.metainfo.xml
    sources:
      - type: extra-data
        filename: Minion.zip
        sha256: 7ed2a5804462b6dec7d0f4f7b1b96b9279b71ed81939ef03f65f28d9e1c72e1e
        size: 8046835
        url: https://cdn.mmoui.com/minion/v3/Minion3.0.11-java.zip
        # Not using x-checker-data as the used version here is NOT available on the site
        # but it IS added by the developers exclusively for the flatpak.
        #
        # The version for Minion3 will not change as the developers are working on Minion4
        # and the flatpak will need to be manually updated for Minion4 support when it comes out.
        #
        # x-checker-data:
        #   type: html
        #   url: https://minion.mmoui.com/?download
        #   pattern: "href=\"(https://cdn.mmoui.com/minion/v3/(Minion\\d+.\\d+.\\d+)-java.zip)\""
      - type: script
        dest-filename: apply-extra
        commands:
          - unzip -q Minion.zip
          - mv Minion*-java/* .
          - rm -rf __MACOSX Minion*-java
          - rm Minion.zip
      - type: script
        dest-filename: minion.sh
        commands:
          # If someone does press udpate it won't create a null folder + it won't hang the application
          - cd /tmp
          - "java -jar --module-path /app/javafx/lib \
              --add-modules=javafx.graphics,javafx.fxml,javafx.web \
              --add-reads javafx.graphics=ALL-UNNAMED \
              --add-opens javafx.graphics/javafx.scene.image=ALL-UNNAMED \
              --add-opens javafx.graphics/com.sun.javafx.css=ALL-UNNAMED \
              --add-opens java.base/java.lang=ALL-UNNAMED \
              /app/extra/Minion-jfx.jar"
      - type: file
        path: gg.minion.Minion.png
      - type: file
        path: gg.minion.Minion.desktop
      - type: file
        path: gg.minion.Minion.metainfo.xml
